{% extends "base.html" %}
{% import "bootstrap_wtf.html" as wtf %}

{% block content %}
<div class="container mt-4">
  <h2>Welcome, {{ user.name }}</h2>
  <p>Role: {{ user.role }}</p>
  <p>Email: {{ user.email }}</p>
  <hr>

  {% if user.role == 'admin' %}
    <!-- Admin Add Course Form (保持不变) -->
    ...（略，为节省空间保留你原有内容）...

  {% elif user.role == 'student' %}
    <!-- ✅ 学生修改信息表单 -->
    <h3 class="mt-4">Edit Profile</h3>
    <form method="POST">
      {{ student_form.hidden_tag() }}
      <div class="mb-3">
        {{ student_form.username.label(class="form-label") }}
        {{ student_form.username(class="form-control") }}
      </div>
      <div class="mb-3">
        {{ student_form.interests.label(class="form-label") }}
        {{ student_form.interests(class="form-select", multiple=True) }}
      </div>
      <div class="mb-3">
        {{ student_form.submit(class="btn btn-success") }}
      </div>
    </form>

    <!-- ✅ 系统通知 -->
    <h3 class="mt-4">System Notifications</h3>
    <ul>
      {% for note in notifications %}
        <li>{{ note.timestamp.strftime('%Y-%m-%d %H:%M') }} - {{ note.message }}</li>
      {% else %}
        <li>No Notifications.</li>
      {% endfor %}
    </ul>

  {% elif user.role == 'mentor' %}
    <!-- ✅ 导师修改信息表单 -->
    <h3 class="mt-4">Edit Mentor Profile</h3>
    <form method="POST">
      {{ mentor_form.hidden_tag() }}

      <div class="mb-3">
        {{ mentor_form.username.label(class="form-label") }}
        {{ mentor_form.username(class="form-control") }}
      </div>
      <div class="mb-3">
        {{ mentor_form.expertise.label(class="form-label") }}
        {{ mentor_form.expertise(class="form-select", multiple=True) }}
      </div>
      <div class="mb-3">
        {{ mentor_form.self_introduction.label(class="form-label") }}
        {{ mentor_form.self_introduction(class="form-control", rows=3) }}
      </div>

      <div class="mb-3">
        <label class="form-label">Available Time Slots</label>
        <div id="mentor-slots">
          {% for slot in mentor_form.time_slots %}
            <div class="row g-2 mb-2">
              <div class="col-md-4">{{ slot.day(class="form-select") }}</div>
              <div class="col-md-4">{{ slot.start_time(class="form-control") }}</div>
              <div class="col-md-4">{{ slot.end_time(class="form-control") }}</div>
            </div>
          {% endfor %}
        </div>
        <button type="button" class="btn btn-outline-secondary btn-sm" id="add-slot">Add Time Slot</button>
      </div>

      <div class="mb-3">
        {{ mentor_form.submit(class="btn btn-success") }}
      </div>
    </form>
  {% endif %}
</div>

<!-- JS: 联动 + 动态添加时间段 -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  $('select[multiple]').select2({
    width: '100%',
    placeholder: "Select one or more",
    allowClear: true
  });

  const container = document.getElementById('mentor-slots');
  const addSlot = document.getElementById('add-slot');
  if (addSlot) {
    addSlot.addEventListener('click', () => {
      const index = container.children.length;
      const slotHTML = `
        <div class="row g-2 mb-2">
          <div class="col-md-4">
            <select name="time_slots-${index}-day" class="form-select" required>
              <option value="">Select Day</option>
              <option value="Mon">Monday</option>
              <option value="Tue">Tuesday</option>
              <option value="Wed">Wednesday</option>
              <option value="Thu">Thursday</option>
              <option value="Fri">Friday</option>
            </select>
          </div>
          <div class="col-md-4">
            <input type="time" name="time_slots-${index}-start_time" class="form-control" required>
          </div>
          <div class="col-md-4">
            <input type="time" name="time_slots-${index}-end_time" class="form-control" required>
          </div>
        </div>
      `;
      container.insertAdjacentHTML('beforeend', slotHTML);
    });
  }
});
</script>
{% endblock %}
